### 神谷マリア・放置ゲーム仕様書 (最新版)

#### 0. チップについて

　このミニゲームは雨宿りの活動を促すために作られた
　そのためチップはゲーム内ではなく、サーバー内での活動によって得られる。
　通常はログボで7500-2000枚、発言で100枚、バイトをするというコマンドをすると高速で（１回600枚）なんどでも稼げる。自然に進めてもいいし、早く進めたい人はバイト連打でクリッカーのように遊べる。

#### 1. 基本施設データ

各施設のコストは `基本コスト * (コスト成長率 ^ 現在レベル)` で計算され、TPスキル#6によって割引されます。

| 施設名                            | 絵文字 | 基本コスト | コスト成長率 | 基本効果 (Effect)  | 解禁条件                     |
| :-------------------------------- | :----: | :--------- | :----------- | :----------------- | :--------------------------- |
| **ピザ窯 (Oven)**                 |   🍕   | 100        | `x 1.08`     | `+1` (加算)        | 初期から                     |
| **チーズ工場 (Cheese)**           |   🧀   | 500        | `x 1.09`     | `+0.09` (乗算)     | 初期から                     |
| **トマト農場 (Tomato)**           |   🍅   | 700        | `x 1.10`     | `+0.08` (乗算)     | 人口 100万                   |
| **マッシュルーム農場 (Mushroom)** |   🍄   | 900        | `x 1.105`    | `+0.07`(乗算)      | 人口 1,000万                 |
| **アンチョビ工場 (Anchovy)**      |   🐟   | 1,100      | `x 1.11`     | `+0.06` (乗算)     | 人口 1億                     |
| **オリーブ農園 (Olive)**          |   🫒   | 1,300      | `x 1.115`    | `+0.05` (上位乗算) | 実績#73(人口1兆)             |
| **小麦の品種改良 (Wheat)**        |   🌾   | 1,500      | `x 1.12`     | `+0.04` (上位乗算) | 実績#74(ovenLv70 + 人口1e16) |
| **パイナップル農園 (Pineapple)**  |   🍍   | 1,700      | `x 1.125`    | `+0.03` (上位乗算) | 実績#66(チャレンジ制覇)      |
| **精肉工場 (Meat)**               |   🍖   | -          | -            | `+0.01` (**指数**) | 初期から                     |

- **上位乗算施設 (オリーブ, 小麦, パイナップル):** SPスキル#1の効果対象外です。また、解禁実績を達成するまでPP(プレステージパワー)の効果を受けません。
- **プレステージ後:** 人口による施設解禁条件はすべて解除されます。

#### 2. 施設効果の計算式

##### **A) ピザ窯 (Oven) - 加算施設**

`最終効果 = (ピザ窯Lv + PP) * (1 + (TPスキル#5 Lv * 0.01) * ピザ窯Lv)`

##### **B) チーズ 〜 パイナップル - 乗算施設**

1.  `強化後効果 = 基本効果 * (1 + (TPスキル#5 Lv * 0.01) * 施設Lv)`
2.  `最終効果 = 1 + 強化後効果 * (施設Lv + PP)`
    - ※上位乗算施設の場合、解禁実績未達成時は `PP` が `0` として計算されます。(＝x1扱い)

##### **C) 精肉工場 (Meat) - 指数施設**

`最終効果(指数) = 1 + 0.01 * (Mee6 Lv + PP + 実績解除数) + (実績#66ボーナス)`

- **実績#66ボーナス:** 実績「工場の試練」達成で解禁。
  - `ボーナス値 = 0.001 * (精肉工場を除く全工場の合計レベル)`

#### 3. プレステージ関連の計算式

| 要素                        | 計算式 / 説明                                                                                                                                             |
| :-------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **PP (プレステージパワー)** | `log10(プレステージ時の人口)`（最高値で更新）                                                                                                             |
| **SP (スキルポイント)**     | 1回目：`PP - 7`　2回目以降: 前回からのPP増加分 がそのまま加算される                                                                                       |
| **TP (超越ポイント)**       | `(log10(プレステージ時の人口) - 15) ^ 2.5`<br>※人口 `1e16` 以上でのプレステージで獲得可能。                                                               |
| **TP獲得リセット**          | 最高人口を更新せずとも、現在人口が `1e16` 以上であれば、いつでもプレステージしてTPのみを獲得できます。この場合、PP/SPは増えず、最高人口も更新されません。 |

---

#### 4. スキル一覧

##### **SPスキル (スキル#1〜#4)**

| スキル                    | コスト計算        | 効果                                                                                                                  |
| :------------------------ | :---------------- | :-------------------------------------------------------------------------------------------------------------------- |
| **#1 燃え上がるピザ工場** | `2 ^ (現在Lv)` SP | **基本5施設(Oven〜Anchovy)の**効果を `(1 + Lv) * (スキル#4効果)` 倍する。5施設は乗算なので結果として効果は5乗される。 |
| **#2 加速する時間**       | `2 ^ (現在Lv)` SP | ゲームスピードを `((1 + Lv) * (スキル#4効果)) ^ 2` 倍する。                                                           |
| **#3 ニョボシの怒り**     | `2 ^ (現在Lv)` SP | チャットなどで得られるチップ獲得量を `(1 + Lv) * (スキル#4効果)` 倍する。                                             |
| **#4 【光輝】**           | `2 ^ (現在Lv)` SP | スキル#1〜#3の効果を `1 + (Lv * 0.1)` 倍する。                                                                        |

##### **TPスキル (スキル#5〜#8)**

| スキル                        | コスト計算               | 効果                                                                                                                                    |
| :---------------------------- | :----------------------- | :-------------------------------------------------------------------------------------------------------------------------------------- |
| **#5 熱々ポテト**             | `1 * (1.5 ^ 現在Lv)` TP  | 各施設の効果計算時、自身の基礎レベルに応じて基本効果が `Lv * 1%` ずつ加算強化される。                                                   |
| **#6 スパイシーコーラ**       | `10 * (2 ^ 現在Lv)` TP   | 施設コストを割引。割引率 `1 - (0.97 ^ Lv)`。90%超過分は半減するソフトキャップあり。                                                     |
| **#7 山盛りのチキンナゲット** | `10 * (1.8 ^ 現在Lv)` TP | ブースト倍率が、Infinity中に消費したチップ量に応じて強化される。**最終的なブースト倍率**が `* (1 + (消費チップ) ^ (Lv * 0.1))` される。 |
| **#8 至高の天ぷら**           | `40 * (3 ^ 現在Lv)` TP   | TP獲得量を `1 + (Lv * 1.0)` 倍する (+100% per Lv)。                                                                                     |

---

#### 5. 最終生産量 (ニョワミヤ/分) の総合計算式

`最終生産量 = (基本生産量 ^ 肉効果) * バフ倍率 * スキル#2効果`

- **`基本生産量`**
  - `= Oven効果 * Cheese効果 * Tomato効果 * Mushroom効果 * Anchovy効果 * (スキル#1効果 ^ 5) * Olive効果 * Wheat効果 * Pineapple効果`
  - ※スキル#1効果は基本5施設にのみ適用されます。

- **`肉効果` (指数)**
  - `= 1 + 0.01 * (Mee6 Lv + PP + 実績数) + (0.001 * 精肉以外の全施設合計Lv)` (精肉以外の全施設合計Lvは実績#66達成後反映)
  - **ソフトキャップ**: ^10から緩めの、^12から硬めのソフトキャップがかかる。(Infinity時でおよそ6~7台。Break infinityでの暴走を防ぐため)　インフィニティ以降のボーナスは対象外

- **`バフ倍率`**
  - `= 基本ブースト * (1 + スキル#7ボーナス) * 実績コンプボーナス`
  - **基本ブースト**: 4.0倍 (Prestige前&人口100万以下), 3.0倍(Prestige前), 2.0倍 (Prestige後)
  - **スキル#7ボーナス**: `(消費チップ) ^ (スキル#7 Lv * 0.1)`
  - **実績コンプボーナス**: 実績#50達成で `x1.5`、隠し実績#10達成で `x1.1`

- **`スキル#2効果`**
  - `= ((1 + スキル#2 Lv) * (1 + スキル#4 Lv * 0.1)) ^ 2`

#### 6. アセンション

インフィニティを目指す過程での、最後の強化要素です。

- **実行条件:** 人口 `1e40` \* (10 ^ アセンション回数) 、8工場全ての解禁
- **効果:** 全8工場の基本生産力に `(1.125 ^ アセンション回数)` の倍率がかかる。
- **費用:** 全8工場を1レベル上げるのに必要なチップの合計がかかる。 0->1 1->2...

#### 7. インフィニティ(∞)

人口が `1.79e308` に達すると実行可能な、最上位のリセット機能です。（ゲームクリアー）
エンディングが表示され、チップを除いた全てがリセットされます。
リセットされるもの：
人口、最高人口、全ての工場、チップボーナス、PP、SP、TP、全てのスキル、アセンション、インフィニティ中の消費チップ(#7スキルの底)、∞中の経過時間、GP、ジェネレーターの個数
リセットされないもの：
ジェネレーターの購入数、IPアップグレード（未実装）、実績や試練の報酬、エタニティ中のゲーム内経過時間や消費チップ数統計
得られるもの：
1∞と、所定のIP、(初回のみ)チップの獲得量に(#3スキルの効果を受けない)+5000%の加算

##### **7.1 IP (インフィニティポイント) 獲得量**

- **基本値:** 1 IP
- **実績#84ボーナス:** 5回目のインフィニティ達成以降、基本値が **2倍** になる。
- **ICボーナス(未実装):** ICクリア数に応じて基本値に(`1 + クリア数`)の倍率がかかる。
- **ブレイク後:** G2初購入後、人口に応じて獲得量が指数関数的に増加する。(`基本値× 10 ^ (log10(人口) / 308 - 0.75)`)

##### 7.2.インフィニティジェネレーター

IPを消費して購入できる、インフィニティ後の主要な生産施設です。

| ジェネレーター | 生産対象 | コスト計算                | 特殊効果                                         |
| :------------- | :------- | :------------------------ | :----------------------------------------------- |
| **G8**         | G7       | `1e30 * (1e8 ^ 購入数)`   | -                                                |
| **G7**         | G6       | `1e22 * (1e7 ^ 購入数)`   | -                                                |
| **G6**         | G5       | `1e16 * (1e7 ^ 購入数)`   | -                                                |
| **G5**         | G4       | `1e11 * (1e5 ^ 購入数)`   | -                                                |
| **G4**         | G3       | `1e7 * (1e4 ^ 購入数)`    | -                                                |
| **G3**         | G2       | `10000 * (1000 ^ 購入数)` | -                                                |
| **G2**         | G1       | `100 * (100 ^ 購入数)`    | 人口の上限が撤廃される(インフィニティブレイク)   |
| **G1**         | **GP**   | `1 * (10 ^ 購入数)`       | 最終的なGP生産量は `インフィニティ回数` 倍される |

- **購入効果:** ジェネレーターを1つ購入するごとに、そのジェネレーターの生産効率が **2倍** になる (`2^(購入数-1) / 分`)。
- **生産:** 生産は分速であり、#2などのゲーム時間加速効果の影響を受ける。
- **GP (ジェネレーターパワー):** 全8工場の最終的な効果を `GP ^ 0.5 (8工場合計でGP ^ 4)` 倍する、非常に強力なブースト。
- **ソフトキャップ:** GP^ジェネ指数＝Xが`1e1000`を超えると、`X/ 10^1000^0.1 *10^1000`のソフトキャップがかかる。

##### 7.3. インフィニティアップグレード

IPを消費して購入できる、インフィニティ後のスキルです。
Tierを制覇後、次のTierが解禁される。

| ID     | アップグレード名           | コスト      | 効果                                                                                         |
| :----- | :------------------------- | :---------- | :------------------------------------------------------------------------------------------- |
| `IU11` | **ゴーストチップLvX**      | 0 IP        | リセット(プレステージ,インフィニティ)時に無償で得るチップの範囲で、工場を自動強化する。      |
| `IU12` | **自動調理器**             | 1 IP        | TP、SPお任せアップグレードの解禁                                                             |
| `IU13` | **肉干しレンガ**           | 1 IP        | 精肉工場の指数に `+0.05` のボーナス。                                                        |
| `IU14` | **業務用品の購入**         | 1 IP        | チップ消費量x0.9                                                                             |
| `IU21` | **パインパワー**           | 3 IP        | PP獲得量+10%(SPも増える)                                                                     |
| `IU22` | **無限の試練**             | 2 IP        | インフィニティチャレンジの解禁                                                               |
| `IU23` | **より良い広告**           | 3 IP        | アセンション倍率 +0.025                                                                      |
| `IU24` | **惑星間高速道路**         | 10 IP       | 全ての工場×(1+∞/5)                                                                           |
| `IU31` | **小型発電機**             | 16 IP       | G1が5倍強化                                                                                  |
| `IU32` | **中型発電機**             | 128 IP      | G2が3倍強化                                                                                  |
| `IU33` | **IP還元装置**             | 444 IP      | 所持IPに応じてG1強化 max(log10(IP)\*4/3,1.5) 　                                              |
| `IU34` | **IP循環装置**             | 512 IP      | 所持IPに応じてG2強化 max(log10(IP)\*4/5,1.2)                                                 |
| `IU41` | **古びた発電機**           | 1024 IP     | ∞に応じて若干G2強化 ∞>10のとき、√(∞/10)倍G2強化                                              |
| `IU42` | **ジェネレーターの最適化** | 1024 IP     | GP指数が0.5 -> 0.75                                                                          |
| `IU43` | **節税政策**               | 1024 IP     | ニョボチップ1.2倍(infinity報酬の5000%も6000%に)                                              |
| `IU44` | **霊的特異点**             | 1024 IP     | インフィニティリセット時にもゴーストチップが発動する                                         |
| `IU51` | **IPメガキャノン**         | 2048 IP     | チャレンジ9の最短時間に基づいてIP増加 (15~1.5)                                               |
| `IU52` | **魔剣グラム**             | 2048 IP     | チャレンジ9の最短時間に基づいてG1強化 (25.18~2.5)                                            |
| `IU53` | **神槍グングニル**         | 2048 IP     | チャレンジ9の最短時間に基づいてG2強化 (18.15~2)                                              |
| `IU54` | **先行投資**               | 10000 IP    | ゴーストチップLvCap200 -> 999 、インフィニット時別個のチップでアセンションも行う（人口無視） |
| `IU55` | **無限は無限へ**           | 10000 IP    | ∞に応じてIP強化 `1 + log10(∞ + 1) × 1.05`倍                                                  |
| `IU61` | **大型発電機**             | 1000000 IP  | G1を10倍強化                                                                                 |
| `IU62` | **並行宇宙観測装置**       | 2000000 IP  | 全ての獲得∞がlog10(チップ枚数 + 1) + 1倍になる(小数点以下切り捨て)                           |
| `IU63` | **空間歪曲マシン**         | 1000000 IP  | ∞に応じてG3強化（`1+ log10(∞+1)x 0.80`倍）                                                   |
| `IU64` | **因果律の増幅**           | 3000000 IP  | ∞に応じてチップ獲得量増加 `1 + log10(∞ + 1 ) x 0.10`                                         |
| `IU65` | **広告シミュレーター**     | 10000000 IP | ∞に応じてアセンション強化　`1 + log10(∞ + 1) / 9`倍                                          |
| `IU71` | **無限循環装置**           | 1e11 IP     | ジェネレーター3号機の出力が(2号機の購入数+1)倍                                               |
| `IU72` | **エントロピー縮小機関**   | 1e11 IP     | ジェネレーター4号機の出力が(3号機の購入数+1)倍                                               |
| `IU73` | **不思議な望遠鏡**         | 2e11 IP     | 取得後最短の∞時間を計測開始、最短infinity（現実時間準拠）の1/30の速度で∞を獲得               |
| `IU74` | **歪んだ歯車**             | 1e12 IP     | ジェネレーター指数が0.75 -> 0.9                                                              |
| `IU81` | **超時空エンジン**         | 1e21 IP     | 全てのジェネレーターが `1 + 100/最速infinity(ms)`倍 IU73,81最速infinity時間 1/3(最低1ms)     |
| `IU82` | **自己増殖セル**           | 1e27 IP     | ジェネレーター指数 `+ 0.12×log10(log10(GP/1e35))`                                            |
| `IU91` | **ニョワミヤ銀河系**       | 1e60 IP     | ギャラクシーの解禁                                                                           |

- **IU11『ゴーストチップ』:** 初期Lv1,最大200 。チップは`5000 * Lv` であり、強化費用は `Max(Lv * 500000 ,5000000)`チップ
- IU33: 10/7にするかも
- IU34: 6/7にするかも
- IU51-53: 60秒以内で最大、以降は経過時間が２倍になるにつれて-1倍（IC9未クリア時、1倍）

##### 7.4. インフィニティチャレンジ(IC)

自身に縛りを課してInfinityを目指すエンドコンテンツ。
条件を満たしたら取れるか、呪いを受けてインフィニティをリセットする形で開始。攻略順はIC1-8は自由、9は必ず最後となる。
例）
| 試練 | 名前 | 縛り内容 | 報酬 |
|---|---|---|---|
| IC1 | ニョボシの夏休み | #7が無効化、ニョワミヤ人口が∞中チップ消費量で除算 | #7の計算式にさらにエタニティ内消費チップを加算 |
| IC2 | 腹が減って死にそうだ！ | ゲーム内時間12時間以内にインフィニティ | #2効果の^0.25がオリーブ、小麦、パイナップルの生産量にかかる(実質 2乗->3.5乗) |
| IC3 | サイドメニューは割高 | TP式が ^ 2.0(-0.5) | TP式が ^ 2.7(+0.2) |
| IC4 | ベジタリアンピザ | Mee6Lvが0固定 | 指数+0.10 |
| IC5 | パッシブ光輝は禁止！禁止です！ | #4取得不可 | #4効果+20% |
| IC6 | ライバル現る！？ | 実時間60秒ごとに毎分人口e1ずつ増えるニョーワピザが出現。起動時に負けるとチャレンジ中断 | Infinity時、それぞれIP桁数分のSPで#1~#4が強化された状態で始まる |
| IC7 | 貧乏くじは引きたくない | アセンション要求人口が e40 _ e1^n　-> 1 _ e10^nに | アセンション倍率 +0.025 |
| IC8 | アドブロッカー | アセンション禁止 | アセンション倍率 1.2倍 |
| IC9 | 原点回帰 | オリーブ、小麦改良、パイナップル使用不可 | IP2倍(＋全てのジェネレーター性能2倍) |

- **報酬:** それぞれの試練にちなんだ報酬が得られる他、IPが(1 + ICクリア数)倍になる。全てのICをクリアすると、全てのジェネレータの性能が2倍となる。
- **呪い:** 一部のICを受けるとインフィニティがリセットされ、インフィニティをするかICを諦める以外縛りを解く方法はない

#### 8. ギャラクシー

ギャラクシーを購入することで「グラビティ」が産出され、全てのジェネレーターが爆発的に強化される。グラビティはインフィニティリセットで`1`に戻る。

- **グラビティ産出量/分:** **`0.01`** `* (ベース値 ^ 所持ギャラクシー数)`
- **ジェネレーター強化倍率:** `グラビティ ^ グラビティ指数`

##### **ギャラクシーコスト**

| ギャラクシー数 | 要求IP      |
| :------------- | :---------- |
| 1個目          | `1e60`      |
| 2～11個目      | `+e3` ずつ  |
| (11個目)       | `1e90`      |
| 12～33個目     | `+e5` ずつ  |
| (33個目)       | `e200`      |
| (34個目)       | `e215`      |
| 34個目以降     | `+e15` ずつ |

##### **アップグレード**

IPを消費して、グラビティの産出効率と効果を永続的に強化できる。
初期値はベースが1.5、グラビティ指数0.45
| アップグレード名 | 効果 | コスト |
| :--------------- | :--------------------------- | :-------------- |
| ベース値強化 | `+0.15` ずつ | `1e60` IPからe12刻み |
| チップ強化 | `+0.15` ずつ | `1億`チップからe1刻み |

| アップグレード名   | 効果         | コスト (e21刻み) |
| :----------------- | :----------- | :--------------- |
| グラビティ指数強化 | `+0.05` ずつ | `1e60` IPから    |

### グラビティアップグレード

グラビティを消費して購入できる、インフィニティ後もリセットされない永続的な強化要素。
ジェネレーター画面の下部に表示され、購入する。

#### アップグレード一覧

| アップグレード名       | 効果                                                      | 最大レベル | コスト計算式 (Gravity)        |
| :--------------------- | :-------------------------------------------------------- | :--------: | :---------------------------- |
| **ジェネレーター拡張** | `インフィニティ回数`ボーナスが **G(1+Lv)** まで適用される |     7      | 初期: `1e6`, 成長率: `x 1e6`  |
| **無限の増幅**         | ∞（インフィニティ）の最終獲得量が **(1 + Lv)** 倍になる   |     ∞      | 初期: `1e9`, 成長率: `x 1e3`  |
| **肉質強化**           | 精肉工場の**最終指数**に `+ (Lv * 0.05)` を加算する       |     50     | 初期: `1e12`, 成長率: `x 1e6` |
| **望遠鏡の改良**       | IU73による受動的な∞獲得量が **1.05 ^ Lv** 倍になる        |     80     | 初期: `1e18`, 成長率: `x 1e6` |

---

#### 各アップグレードの詳細な効果

##### 1. ジェネレーター拡張 (infBonusOnGen)

- **効果:** 通常、`インフィニティ回数`を乗算するボーナスはG1のGP生産にしか適用されません。このアップグレードを取得すると、その効果範囲がより上位のジェネレーターにまで拡大されます。
- **計算例:**
  - Lv.0 (初期状態): G1の生産量にのみ`インフィニティ回数`が乗算される。
  - Lv.1: G1と**G2**の生産量に`インフィニティ回数`が乗算される。
  - Lv.7 (最大): G1から**G8**まで、全てのジェネレーターの生産量に`インフィニティ回数`が乗算される。

##### 2. 無限の増幅 (infGain)

- **効果:** インフィニティリセット時、およびIU73による受動的な∞獲得量の**最終値**に乗算ボーナスがかかります。
- **計算式:**
  `最終的な∞獲得量 = (全てのボーナス適用後の∞獲得量) * (1 + このアップグレードのレベル)`

##### 3. 肉質強化 (meatExponentBonus)

- **効果:** 精肉工場の指数（`meatEffect`）の**最終値**に直接加算ボーナスを与えます。このボーナスは、PPや実績などによる指数のソフトキャップが計算された**後**に適用されるため、非常に強力です。
- **計算式:**
  `最終的な肉効果 = (ソフトキャップ適用後の指数 + IU13/IC4ボーナス) + (このアップグレードのレベル * 0.05)`

##### 4. 望遠鏡の改良 (telescopeBoost)

- **効果:** IU73「不思議な望遠鏡」による、時間経過での自動的な∞獲得量を強化します。
- **計算式:**
  `最終的な受動∞獲得量 = (IU73の基本獲得量) * (1.05 ^ このアップグレードのレベル)`

#### 9.エタニティ（Σ）（未実装）

ゲーム全体の最終目標。
1.79e+308IP でエンディングとなり、EP（未実装）とΣ（未実装）が追加される。
そして所持ニョボチップとinfinityまでの要素の全てを失う。

#### 9.1 エタニティマイルストーン(100以降は未実装)

| Σ数 | 効果                                                             | 備考　                                                  |
| --- | ---------------------------------------------------------------- | ------------------------------------------------------- |
| 1   | Σに応じたエタニティボーナスの解禁                                | 実質無し                                                |
| 2   | 　 全ての自動化の解禁                                            | IU11、IU12、IU44、IU54を初期取得(ゴーストチップのLvは1) |
| 3   | 最短インフィニティ時間が維持される                               |                                                         |
| 4   | インフィニティアップグレード・ジェネレーターの自動購入（ |                                                         |
| 5   | 工場購入はチップを消費せず、ゴーストチップが999Lvから始まる      | チップを持っている必要はある                            |
| 6   | ギャラクシー・グラビティの自動購入                                 |                                                         |
| 10  | エタニティブレイク                                               | IPの上限解除                                            |
| 100 | IPボーナス(未実装のままでも良い)                                 | ...                                                     |

#### 9.2 エタニティボーナス(未実装)

##### **Σ工場倍率 (Eternity Mult Gain Bonus)**

全8工場の最終生産量に乗算される倍率。

$$
\text{倍率} =
\begin{cases}
1 + \Sigma & (\Sigma < 20) \\
\left( \frac{1 + \Sigma}{21} \right)^{0.1} \times 21 & (\Sigma \geq 20)
\end{cases}
$$

##### **Σチップ獲得量 (Eternity Lap Speed Bonus)**

チャットやログインボーナスで得られるチップの最終獲得量に乗算される倍率。

$$
\text{倍率} =
\begin{cases}
1 + \Sigma & (\Sigma < 20) \\
\left( \frac{1 + \Sigma}{21} \right)^{0.1} \times 21 & (\Sigma \geq 20)
\end{cases}
$$

##### **Σアセンションパワー (Eternity Ascension Power Bonus)**

アセンション効果の**基礎倍率** (`1.125`などの部分) に乗算される。

$$
\text{倍率} =
\begin{cases}
1 + \frac{\Sigma}{10} & (\Sigma < 20) \\
\left( \frac{1 + \frac{\Sigma}{10}}{3} \right)^{0.3} \times 3 & (\Sigma \geq 20)
\end{cases}
$$

##### **Σインフィニティ獲得量 (Eternity Infinity Gain Bonus)**

インフィニティ（∞）の最終獲得量に乗算される倍率。

$$
\text{倍率} =
\begin{cases}
(1 + \Sigma)^{1.2} & (\Sigma < 20) \\
\left[ \left( \frac{(1 + \Sigma)^{1.2}}{21^{1.5}} \right)^{0.1} \times 21^{1.5} \right]^2 & (\Sigma \geq 20)
\end{cases}
$$

##### **Σジェネレーターパワー (Eternity Generators Power Bonus)**

GP（ジェネレーターパワー）の最終獲得量に乗算される倍率。

$$
\text{倍率} =
\begin{cases}
(\Sigma + 1)^{1.1} & (\Sigma < 20) \\
\left( \frac{(\Sigma + 1)^{1.1}}{21^{1.3}} \right)^{0.1} \times 21^{1.3} & (\Sigma \geq 20)
\end{cases}
$$

##### **Σグラビティ獲得量 (Eternity Stardust Gain Bonus)**

グラビティの最終獲得量に乗算される倍率。

$$
\text{倍率} =
\begin{cases}
10^{\Sigma} & (\Sigma < 10) \\
\Sigma^{10} & (\Sigma \geq 10)
\end{cases}
$$

##### **Σマイルストーン (IPボーナス)**

`100Σ` 達成で、IPの最終獲得量に `x1.05` の永続ボーナス。
_(画像の式は `1.05^Eternities` と `(Eternities/1000)^0.1 _ 1000` の組み合わせなので、より強力なボーナスとして解釈)\*

##### **マイルストーンIP倍率 (Eternity Milestone 11 Bonus)**

$$
\text{倍率} =
\begin{cases}
1.05^{\Sigma} & (\Sigma < 1000) \\
1.05^{\left( \frac{\Sigma}{1000} \right)^{0.1} \times 1000} & (\Sigma \geq 1000)
\end{cases}
$$

- **※ギャラクシー:** 将来的に実装予定のジェネレーター強化要素。
- **ソフトキャップ:** 一定のΣ回数を超えると、各ボーナスの伸び率は緩やかになる可能性があります。

#### 9.3 クロノポイント (CP) (実装予定)

エタニティを達成した者がアクセスできる、時間を超越した新たな強化要素です。CPは、ゲームの根幹に関わる強力で永続的なアップグレードに使用されます。

##### CPの獲得方法

CPは、これまでに蓄積した各種リソースを「捧げる」ことで獲得できます。ただし、CPを1つ獲得するごとに、次に同じリソースを捧げる際の要求コストは指数関数的に増加していきます。
捧げるリソース 初期コスト コスト増加倍率
ニョワミヤ 1e20000 x 1e20000
Infinity Point (IP) 1 x 1e100
Eternity Point (EP) 1 x 2
コスト計算式: 次に必要なコスト = 初期コスト \* (コスト増加倍率 ^ そのリソースからCPを獲得した回数)

##### CPの消費

エタニティまでの区間を楽にする効果やスキルを実装予定です。

### 10.カラミティ(𝒞)

ゲーム全体。
カラミティ中のチップ消費量や経過時間は、リセットされることはない。

### 11. ランキングスコア (Rank Score) について

ランキングの順位を決定するためにのみ使用される内部的な数値。
単純な「IP > 人口」という基準では、プレステージやインフィニティ、IPアップグレードの利用によって順位が大きく変動する問題があった。新しいスコアシステムでは各プレイヤーが到達した「最大値（レコード）」を記録・評価することで、ゲームをリセットしても進行度が正当に評価され、ランキングが安定する。

#### 11.1. スコアの算出方法

スコアは、以下の各要素を算出し、それらをすべて乗算することで計算される。

> **`Rank Score = 人口スコア * 指数スコア * ∞回数スコア * IPスコア * ICスコア　* 銀河スコア * Σ回数スコア * EPスコア`**

各スコアの計算式は以下の通り。

- `人口スコア = (1 + log10(1 + 最高人口))`
- `指数スコア = (最大指数) ^ 0.5`
- `∞回数スコア = (1 + log10(1 + 最大インフィニティ回数))`
- `IPスコア = (1 + log10(1 + 最大IP))`
- `ICスコア = (1 + ICクリア数 / 10) ^ 0.5`
- `銀河スコア = (1 + 最大ギャラクシー数 / 8) ^ 0.3`
- `Σ回数スコア = (1 + log10(1 + 最大エタニティ回数))^0.25`
- `EPスコア = (1 + log10(1 + 最大EP))`

#### 11.2. スコアの構成要素

スコアの計算に使用される各「最大値」は、`idle_games`テーブルの`rankScoreComponents`カラムにJSON形式で保存される。

| 要素 (キー)         | 説明                                                           |
| :------------------ | :------------------------------------------------------------- |
| `highestPopulation` | これまでに到達した最も高いニョワミヤ人口。                     |
| `meatEffect`        | 最も高かった時の精肉工場の最終的な指数効果（ソフトキャップ込） |
| `infinityCount`     | インフィニティを実行した合計回数。                             |
| `infinityPoints`    | これまでに所持した最も多いインフィニティポイント。             |
| `completedICCount`  | クリアしたインフィニティチャレンジの最大数。                   |
| `maxGalaxies`       | これまでに所持した最も多いギャラクシーの数。                   |
| `eternityCount`     | エタニティを実行した合計回数。                                 |
| `eternityPoints`    | これまでに所持した最も多いエタニティポイント。                 |

これらの最大値は、`/放置ゲーム` コマンドの実行時に、保存されている記録を上回った場合に自動的に更新され、最終的に計算されたスコアは、`rankScore`カラムに保存される。

### 12.実績

　工場やその他のマリアの機能を遊ぶと解禁される。
　基本：N個の実績を解禁すると精肉工場のLvが+N、#1効果が`(1+0.01 x N)`倍になる。
　実績100個解禁以降(実績103効果): 全てのジェネレーターの生産力が`(1+0.01 x N)`倍になる（未実装）

### 13. 主要データベース構造

このゲームは `Sequelize` を用いてSupabaseデータベースと連携しており、起動時に `sync({ alter: true })` によってスキーマが同期されます。以下は、放置ゲームに直接関連する主要なテーブルの概要です。

#### `idle_games` テーブル

ユーザーごとの放置ゲームの全進行状況を保存します。

| カラム名                      | 型      | 説明                                                                  |
| :---------------------------- | :------ | :-------------------------------------------------------------------- |
| `userId`                      | STRING  | DiscordのユーザーID (主キー)                                          |
| `population`                  | TEXT    | 現在の人口 (Decimal文字列)                                            |
| `highestPopulation`           | TEXT    | これまでの最高人口 (Decimal文字列)                                    |
| `pizzaOvenLevel`              | INTEGER | ピザ窯のレベル                                                        |
| `cheeseFactoryLevel`          | INTEGER | チーズ工場のレベル                                                    |
| `tomatoFarmLevel`             | INTEGER | トマト農場のレベル                                                    |
| `mushroomFarmLevel`           | INTEGER | マッシュルーム農場のレベル                                            |
| `anchovyFactoryLevel`         | INTEGER | アンチョビ工場のレベル                                                |
| `oliveFarmLevel`              | INTEGER | オリーブ農園のレベル                                                  |
| `wheatFarmLevel`              | INTEGER | 小麦の品種改良のレベル                                                |
| `pineappleFarmLevel`          | INTEGER | パイナップル農園のレベル                                              |
| `prestigeCount`               | INTEGER | プレステージを行った回数                                              |
| `prestigePower`               | DOUBLE  | プレステージパワー(PP)                                                |
| `skillPoints`                 | DOUBLE  | スキルポイント(SP)                                                    |
| `transcendencePoints`         | DOUBLE  | 超越ポイント(TP)                                                      |
| `skillLevel1` - `skillLevel8` | INTEGER | 各スキルのレベル                                                      |
| `ascensionCount`              | INTEGER | アセンションを行った回数                                              |
| `infinityTime`                | DOUBLE  | 現在の∞周回でのゲーム内プレイ時間(秒)                                 |
| `eternityTime`                | DOUBLE  | 現在のΣ周回でのゲーム内プレイ時間(秒)                                 |
| `infinityPoints`              | TEXT    | インフィニティポイント(IP) (Decimal文字列)                            |
| `infinityCount`               | DOUBLE  | インフィニティを行った回数                                            |
| `generatorPower`              | TEXT    | ジェネレーターパワー(GP) (Decimal文字列)                              |
| `ipUpgrades`                  | JSONB   | ジェネレーターやIUの購入状況 (`{generators: [...], upgrades: [...]}`) |
| `chipsSpentThisInfinity`      | BIGINT  | この周回でのチップ消費量。主にスキル#7の効果計算に使用。              |
| `chipsSpentThisEternity`      | BIGINT  | ゲーム全体での累計チップ消費量。                                      |
| `challenges`                  | JSONB   | ICの進捗状況 (`{activeChallenge: "...", completedChallenges: [...]}`) |
| `settings`                    | JSONB   | 確認スキップなどのユーザー設定                                        |
| `buffMultiplier`              | DOUBLE  | ブーストの倍率                                                        |
| `buffExpiresAt`               | DATE    | ブーストの有効期限                                                    |
| `pizzaBonusPercentage`        | DOUBLE  | チップの獲得量ボーナス(%)                                             |
| `lastUpdatedAt`               | DATE    | 最後に人口計算をした時間                                              |
| `rankScore`                   | DOUBLE  | ランキングに使用される数値                                            |
| `rankScoreComponents`         | JSONB   | ランキングに必要な数値等の記録                                        |
| `eternityCount`               | DOUBLE  | エタニティをした回数(Σ)                                               |
| `eternityPoints`              | TEXT    | エタニティポイント(EP) (Decimal文字列)                                |
| `epUpgrades`                  | JSONB   | EPの強化要素やチャレンジなどを記録する…かもしれないjson               |
| `calamityTime`                | DOUBLE  | ゲーム全体でのゲーム内プレイ時間(秒)                                  |
| `chipsSpentThisCalamity`      | BIGINT  | ゲーム全体での累計チップ消費量。                                      |

#### `points` テーブル

ゲーム内通貨など、ユーザーの資産を管理します。

| カラム名       | 型     | 説明                                       |
| :------------- | :----- | :----------------------------------------- |
| `userId`       | STRING | DiscordのユーザーID (主キー)               |
| `legacy_pizza` | DOUBLE | ゲーム内通貨**「ニョボチップ」**の所持量。 |
| `nyobo_bank`   | DOUBLE | チップ預かり所。                           |

#### `mee6_levels` テーブル

Discordサーバーでの発言量に応じたレベルを管理します。1日2回および起動時にAPI経由で同期されます。

| カラム名 | 型      | 説明                                                                 |
| :------- | :------ | :------------------------------------------------------------------- |
| `userId` | STRING  | DiscordのユーザーID (主キー)                                         |
| `level`  | INTEGER | Mee6レベル。放置ゲームの**精肉工場レベルの基礎値**として利用される。 |

#### `user_achievements` テーブル

ユーザーごとの実績解除状況を保存します。

| カラム名       | 型     | 説明                                                                                                         |
| :------------- | :----- | :----------------------------------------------------------------------------------------------------------- |
| `userId`       | STRING | DiscordのユーザーID (主キー)                                                                                 |
| `achievements` | JSONB  | 実績の解除状況を保存するJSON。`unlocked` (通常), `hidden_unlocked` (隠し) 配列に解除済み実績IDが格納される。 |

### 14.TODO
eternity時のステータスと、Σ5効果で無料化した後約1兆チップを用いた時のステータス
🍕 ピザ窯
Lv. 30 (1.85e+764) Next.209©
🧀 チーズ工場
Lv. 8 (4.88e+762) Next.207©
🍅 トマト農場
Lv. 4 (2.44e+762) Next.213©
🍄 マッシュルーム農場
Lv. 1 (8.91e+761) Next.207©
🐟 アンチョビ工場
Lv. 0 (4.09e+761) Next.229©
🫒 オリーブ農園
Lv. 0 (2.27e+760) Next.271©
🌾 小麦の品種改良
Lv. 0 (1.82e+760) Next.312©
🍍 パイナップル農園
Lv. 0 (1.36e+760) Next.354©
🍖精肉工場 (Mee6)
Lv. 7 (15.42)
ーーーーー
🍕 ピザ窯
Lv. 320 (7.58e+775) Next.1,034,874,081,259©
🧀 チーズ工場
Lv. 267 (5.69e+774) Next.1,025,960,661,023©
🍅 トマト農場
Lv. 238 (4.51e+774) Next.1,037,153,081,180©
🍄 マッシュルーム農場
Lv. 225 (3.73e+774) Next.1,071,620,019,785©
🐟 アンチョビ工場
Lv. 213 (3.03e+774) Next.1,033,886,634,227©
🫒 オリーブ農園
Lv. 203 (1.60e+773) Next.1,071,586,381,188©
🌾 小麦の品種改良
Lv. 194 (1.23e+773) Next.1,105,791,917,598©
🍍 パイナップル農園
Lv. 185 (8.77e+772) Next.1,030,270,650,935©
🍖精肉工場 (Mee6)
Lv. 7 (15.42)
毎分の増加予測
9.9869e+95534 匹/分
人口ボーナス(チップ獲得量)
:nyobochip:+88072271.567 %
現在の所持チップ: 988,889,764,699枚

・・・とまあ、全体的には誤差なので毎Lvごとに*2なんてあってもいい気はしてきた
Lv400でもe120倍だし（最大e1000のジェネ＋スターと比べると弱め）